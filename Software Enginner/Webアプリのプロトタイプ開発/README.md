# Webアプリのプロトタイプ開発

ChatGPT あるいは Azure OpenAI Services の PlayGround などで行います。

こちらが ChatGPT でのチャット履歴になります。

https://chat.openai.com/share/77fb25ed-2fae-4733-b7a6-fa3128b0f0b2


Azure OpenAI Services の PlayGround:

https://learn.microsoft.com/ja-jp/azure/ai-services/openai/chatgpt-quickstart?tabs=command-line%2Cpython&pivots=programming-language-studio

プロトタイプの実装では、利用する製品・サービス・テクノロジーを決めます。

ここでは、サーバー側の処理は Microsoft Azure で。Webアプリは Vue.JS で行います。これはご自身の好みで😊

Vue.JS 入門:

https://learn.microsoft.com/ja-jp/training/paths/vue-first-steps/


# 1. 要求定義

まずは、**役割**の定義から始めます。

```cmd
### 役割
あなたは世界最高峰の**ソフトウェアエンジニアリング**に非常に長けたコンサルタントであり、コーチであるかのように振る舞ってください。

私はソフトエンジニアです。これからアプリケーションの開発とデプロイを行います。

各タスクの達成のために、私からの情報に不足がある場合には、私に問い返してください。

深呼吸をして一歩ずつ取り組んでください。
```


## 1.1 作りたいビジネスシナリオを決める

ここは、思いつくものを書いてみました。他にもあると思いますが。

テーマ: 観光発掘

ターゲットユーザー:

- 郡山に来た人がスムーズに過ごせるように
- ペルソナ: 私 @dahatake

@dahatake の悩み:

- 美味しいごはんを食べたい
- ステキな景色をみたい
- 移動手段を何とかしたい
- 支払い方法を簡略化したい

## 1.2. リサーチ

お客様ご担当者でも理解していない、あるいは、別視点での情報もあるかもしれません。Microsoft Copilot (a.k.a. Bing Chat)で探します。

Prompt:
```cmd
郡山の魅力的な観光情報についてリストアップしてください。歴史的な場所、絶景、他にはない体験、郡山ならではのレストラン、ツーリングなども挙げてください。
可能な限り、その情報についての背景やストーリーも挙げてください。
```

```cmd
観光地を分類するタグを考えてください。
```

# 2. 要件を定義する

ドキュメントは作成しません。あくまで、チームメンバー内で共有できればいいという最低限のものを。
ChatGPT を使います。

機能要件、非機能要件、アプリケーションの構成、そして実装計画を作成していきます。
ちなみに、要件定義にはどんな項目があるのかは、Microsoft Copilot (a.k.a. Bing Chat)に聞くと最良です。

例:
```cmd
アプリケーション開発のための業務要件の定義をするためには、どんな項目を決定する必要がありますか?
```

## 2.1. ユースケースの作成

要件定義は**ユースケース**として作成します。

ユーザーとの会議などで議事録やメールのやり取りの文章があったら、そこから作成してもいいかと思います。

Prompt:
```cmd
### ユースケース作成のタスク
以下のユーザーストーリーから詳細な**ユースケース**を考えてください。

終了の指示があるまで、作成を続けてください。タスクが完了したら、「タスクが完了しました」と出力してください。
タスクを完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。

### ユーザーストーリー
- 福島県郡山市の観光をする観光客をサポートするWebアプリケーションを作成したい
- 美味しいごはんを食べたい
- ステキな景色をみたい
- 移動手段を何とかしたい
- 支払い方法を簡略化したい
- スマホがメインターゲットのデバイス。勿論、同じデータをPCからも使いたい
```

## 2.2. 機能要件の作成

```cmd
### 機能要件作成のタスク
作成したユースケースから詳細な**機能要件**を抽出してください。以下の機能要件の項目が必要です。

終了の指示があるまで、作成を続けてください。タスクが完了したら、「タスクが完了しました」と出力してください。
タスクを完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。

### 機能要件の項目
- アプリケーション開発の目的や背景
- 対象ユーザーや利用シーン
- 主要な機能やサービス
- 画面や操作
- 外部サービスとのやり取り
- 他のアプリケーションやサービスとの依存関係
```

### 2.3. 非機能要件の作成

非機能要件は、緩く作成するわけにはいきません。それでも可能な限り後から変更できるのが望ましいです。

Prompt:

「### ヒアリングドキュメント」には、メールのやり取りなどを入力します。ここでは雑に入れています。


```cmd
### 非機能要件作成のタスク
以下のヒアリングドキュメントから、非機能要件を抽出してください。非機能要件には以下の非機能要件の項目が必要です。

終了の指示があるまで、作成を続けてください。タスクが完了したら、「タスクが完了しました」と出力してください。
タスクを完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。

### 非機能要件の項目
- 可用性
- 性能・拡張性
- 運用・保守性
- 移行性
- セキュリティ
- 環境・サステナビリティ

### ヒアリングドキュメント
システムに求められる非機能要件ですか、そうですね。まあやっぱり止まらないようにしてほしいなと思います。あの休日も正月もそうですけどね。それからユーザーの数はまあ、おそらくですけど、同時にそうですね。100人くらい捌ければいいのかなと思うんですよ。で、後から機能を追加するかもしれないので、ええ、そこの対応ができればいいかなと思ってます。ええそうですね。データのバックアップとかもちろんした方がいいとは思うんですけど、特にええとユーザーさんの課金の情報とか、予約の情報っていうのは、私たちの方で管理するってよりもそうですね。その連携サイトの方で、もちろん持っているわけですけど、ある程度はこちらでも持っておきたいですね。でも多分なくなると困るから、それは24時間 365日すぐでも戻せるようにしてほしいと思います。まあいつお客さんいらっしゃってるかわかりませんからね。予約も含めて現行のシステムはありません。新規に全部作ります。セキュリティですけどね。えっと、もちろんですけど、個人情報に近いところを管理することになると思いますから、その部分に関してはすごく厳密なものが必要だと思います。エコロジーですか。太陽光発電なんかが使える環境があると、いいかなと思いますけどね。まぁほとんどスマホの中のアプリケーションだから、そこまではないかなと思います
```

# 3. モデル・図の作成

ここから先は、**Software Engineering** の作業となります。

## 3.1. アプリケーション アーキテクチャ

どんなアプリケーションのアーキテクチャになるのか。ざっくりと作成します。

Prompt:
```cmd
### アプリケーションアーキテクチャ作成のタスク:
これまでの情報を基にして、アプリケーションのアーキテクチャを作成してください。
Mermaid記法で作成してください。

指示を完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。
```

## 3.2. データモデル

Prompt:
```cmd
### データモデル作成のタスク
**ユースケース**の全てを網羅するデータモデルを作成してください。
Mermaid記法で作成してください。
```

## 3.3. 画面遷移図

Prompt:

```cmd
### 画面遷移図作成のタスク
ユーザーの画面遷移図を作成してください。
Mermaid記法で作成してください。
```

## 3.4. プロジェクトのマイルストーン図

これはおまけです。

Prompt:
```cmd
### プロジェクトのマイルストーン作成のタスク
**ユースケース**と**リソース状況**のを参考にして、プロジェクトの優先順位を考えて、詳細なプロジェクトのマイルストーンを作成してください。初期リリースに必要なものは、全て最優先にしてください。

Mermaid記法で作成してください。
タスクを完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。

### リソース状況
- 初期リリースは3か月後
- 開発者の数は3名
- 最初に以下の機能を提供
    - 初期リリースのマイルストーン
```

この分量になると、Microsoft Word などに貼り付けて、継続利用もいいかもしれません😊

Pandoc の様なツールで。WordからWikiやMarkdownなどに変換できます。
https://github.com/jgm/pandoc

それか Markdown 書式のまま GitHub でもいいかもしれないです。


# 4. プロトタイプ作成

## 4.1. データモデル

DBは、SQLでもNoSQLでもどちらでもいいです。

Prompt:
```cmd
### サンプルデータ作成のタスク
データモデルを参考にして、日本語のサンプルのデータを作成してください。
```

SQL Server の例です。
Promot:
```cmd
### テーブル作成のタスク
以下の使用技術を使います。テーブルの作成のSQL文を作成してください。

### テーブル作成の使用技術:
- Azure SQL Database v12
```

```cmd
### サンプルデータの登録SQL文作成のタスク
サンプルのデータを Azure SQL Database に登録するSQL文を作成してください。
```

Azure Comsmos DB SQL API用です。

Promot:
```cmd
### サンプルデータのインポート用のタスク
サンプルのデータを Azure Cosmos DB NoSQL API 用に作成してください
データベースのインスタンス作成とデータのインポートの詳細な手順書も作成してください。
```

## 4.2. 画面作成

最低限動くものを作成する。「画面」は、マイルストーンの初期フェーズの中で、自分のタスクのものを選択してもいいかと思います。

Prompt:
```cmd
### 画面作成のタスク
以下の使用技術を使って、作成対象画面の画面を作成してください。
単独でも動作するようなサンプルデータも追加してください。

深呼吸をして、一歩ずつ取り組んでください。

### 画面作成のタスクの使用技術:
- HTML5
- Vue.js v3

### 作成対象画面:
- ホーム画面
- レストラン検索画面
```

作成したコードをまずはローカルで動かす手順書も作成します。

Prompt:
```cmd
### 初期ローカル実行の手順書作成のタスク
作成した画面をローカルで動かすための詳細な手順書を作成してください。
ファイルの配置構造も作成してください。
```

## 4.3. API

サーバー側のAPIのひな型を作成します。
どこから始めてもいいのですが。ここではクライアント-APIが動作したら。DB保存ロジックを組みます😊

使用技術はどれか一つを残してください。

クラウドサービスなどは、サポートされている言語のバージョンがそれぞれにあります。必ず確認をしてから指定をしてください。

Azure Functionsのバージョンの概要:
https://learn.microsoft.com/ja-jp/azure/azure-functions/functions-versions?tabs=isolated-process%2Cv4&pivots=programming-language-csharp

```cmd
### サーバー側のAPI作成のタスク
Vue.jsから呼び出すサーバー側のAPIをAzure Functionsにホストするアプリケーションを作成します。以下の使用技術を使って、レストラン検索ロジックのAPI実装にそったコードを作成してください。


### サーバー側のAPI作成のタスクの使用技術
- Azure Functions v4
- C# 13
- .NET 8
- Python 3.11
- Node.js v20

### レストラン検索ロジックのAPI実装:
- DBへの保存ロジックはここでは実装しません。APIを呼び出したらサンプルデータを返します
- サンプルデータは、先に作成したレストランデータを使います
- データの項目毎にAPIにもパラメーターを設定して、フィルタリングが出来るようにします
```


Prompt:
```cmd
### 初期APIの手順書作成のタスク
作成したAPIを実装するための詳細な手順書を作成してください。
ファイルの配置構造も作成してください。
```

クライアント側から、サーバーのAPIを呼び出すコードを作成します。

```cmd
### クライアント画面の更新のタスク
先ほど作成したレストラン検索画面を以下のクライアント画面の更新の条件で更新してください。

### クライアント画面の更新の条件
- レストラン検索ロジックのAPIを呼び出す
- Azure Functions のURLは後で書き換えるため、ここではダミーを用いる
```

動作確認したら、DB保存のコードと入れ替えます。

```cmd
### サーバー側のAPIのコード更新のタスク
サーバー側のAPIのコードに、DBへの検索をするコードを追加します。以下のレストラン
検索ロジックのAPI実装の更新に沿ってコードを作成してください。

### レストラン検索ロジックのAPI実装の更新
- Azure SQL Database からデータを検索します。
- Azure SQL Database には、先に作成したサンプルデータは、格納済みであるとします
- Azure SQL Database への接続情報は、後で設定できるようにします。
- 項目毎にAPIにもパラメーターを設定して、DB検索時にフィルタリングが出来るようにします
```

# 5. レポート作成

DBに日本語での別名(エリアス)を入れなくても、作成してくれます😊

Prompt:
```cmd
### サンプルのクエリ作成のタスク
Azure SQL Database に対して、以下の処理をするクエリを、SQL文で作成してください。

### クエリ:
一番人気のあるレストランはどこですか?
```

# 6. Cloud 環境作成

Microsoft Azure のコンピュートなどを作成して、デプロイをします。

Prompt:
```cmd
### 最適なクラウドのコンポーネント選定理由作成のタスク
アプリケーションアーキテクチャの中の全てのコンポーネントをMicrosoft Azure で動かします。
コストを安く抑えるためにServerlessをなるべく使いたいです。かつスケールアウトできるサービスを選択したいです。それぞれのコンポーネントに最適なMicrosoft Azureのサービスは何ですか?その理由も教えてください。
```

デプロイ先のコンポーネントが見えてきたので、デプロイ用のコードを作成します。


Prompt:
```cmd
### デプロイ用のコード作成のタスク
それぞれのMicrosoft Azureのサービス作成をするAzure CLIのコードを作成してください。CI/CDでは使用サービスを参考にしてください。
アプリケーションの名前は「KoriyamaApps」にします。変数名のプリフィックスとしてください。
詳細な手順書も作成してください。

### デプロイ用のコード作成のタスクの使用サービス
- GitHub
```

# 7. 作成したコードのダウンロード

ChatGPTの場合は、Code Interpreterが統合されています。作成したファイルのダウンロードが出来ます。

これは毎回動くとは限りません。Promptが長すぎる事が原因の一つに考えられます。今後に期待しましょう😊

```cmd
会話の最初から、ここまでに作成した全てのスクリプトやコードの種類一覧を箇条書きにしてください。
```

```cmd
会話の最初から、ここまでに作成した全てのスクリプトやコードをダウンロードできるようにしてください。ゴール達成のステップに不足があったら補ってください。

### ファイルダウンロードのステップ
ステップ1: コードの一覧を作成
ステップ2: 一覧のアイテムごとにファイルのダウンロードの準備
ステップ3: 全てのファイルをzip圧縮
ステップ4: ダウンロードの準備
```

ドキュメントもダウンロードしましょう。

```cmd
会話の最初から、ここまでに作成した全てのスクリプトやコード以外のドキュメントもダウンロードできるようにしてください。
```

# A. メモ

## A.1. 外部サービスの呼び出し
外部サービスの呼び出しをしたいです。Bing Chat や Google Search などで、郡山の観光データベースを探します。

Microsoft Copilot (旧Bing Chat)

Prompt:
```cmd
福島県郡山市の観光名所をAPIとして公開しているサービスはありますか?
```
残念ながらありませんでした。

ですが、以下のサイトは見つかりました。となれば、これをデータベース化する必要がありますね。

https://www.kanko-koriyama.gr.jp/

ここでは残念ですが、幾つかを手作業で入手することにします。Excel に搭載されている Power Query を使って、ローカルにCSVとして出力します。

**データって大事**ですね....

## A.2. アーキテクチャ図の利活用

もし既存のアプリケーションアーキテクチャなどの図が画像としてある場合。その画像から、Microsoft Azure のどのサービスを使うのかを考えさせます。

**GTP-4 with Vision** を使います。

Promot:
```cmd
### クラウドサービスのコンポーネント選定のタスク
アプリケーションを**Microsoft Azure**にデプロイします。
以下のコンポーネント選定の条件を満たすMicrosoft Azureのサービスと、なぜそのサービスを選定したのかの理由を、日本語で箇条書きで作成してください。

終了の指示があるまで、作成を続けてください。タスクが完了したら、「タスクが完了しました」と出力してください。
タスクを完了させるために情報に不足がある場合は、その旨を尋ねてください。
深呼吸をして、一歩ずつ取り組んでください。

### コンポーネント選定の条件
- SPAのWebアプリ
- 可能な限りServerlessを使いたい。初期リリースのコストを抑えるため
- ユーザー数が増えたら容易にスケールアウト出来るようにしたい
```
